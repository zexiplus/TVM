/*! tvvm v1.0.0 | MIT (c) 2018 float | https://github.com/zexiplus/TVM#readme */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),Dep=function(){function e(){classCallCheck(this,e),this.subs=[]}return createClass(e,[{key:"addSubs",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach(function(e){return e.update()})}}]),e}(),Observer=function(){function t(e){classCallCheck(this,t),this.observer(e)}return createClass(t,[{key:"observer",value:function(t){var n=this;t&&"object"===(void 0===t?"undefined":_typeof(t))&&Object.keys(t).forEach(function(e){n.observer(t[e]),n.setReactive(t,e)})}},{key:"setReactive",value:function(t,n){var i=t[n],r=this,a=new Dep;Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return Dep.target&&a.addSubs(Dep.target),i},set:function(e){e!==t[n]&&(r.observer(e),i=e,a.notify())}})}}]),t}(),Watcher=function(){function i(e,t,n){classCallCheck(this,i),this.vm=e,this.expr=t,this.cb=n,this.value=this.getValAndSetTarget()}return createClass(i,[{key:"getValAndSetTarget",value:function(){var e=(Dep.target=this).getValue(this.expr);return Dep.target=null,e}},{key:"getValue",value:function(e){return e.split(".").reduce(function(e,t){return e[t]},this.vm.$data)}},{key:"update",value:function(){var e=this.value,t=this.getValue(this.expr);e!==t&&this.cb&&this.cb(t)}}]),i}(),Compiler=function(){function i(e,t){if(classCallCheck(this,i),this.el=this.getDOM(e),this.vm=t,this.el){var n=this.toFragment(this.el);this.compile(n),this.el.appendChild(n)}else console.error("can not find element named "+e)}return createClass(i,[{key:"compile",value:function(e){var n=this;e.childNodes.forEach(function(e,t){n.isElement(e)?(n.compile(e),n.compileNode(e)):n.isText(e)&&n.compileText(e)})}},{key:"compileText",value:function(t){var n=this,e=/\{\{([^}]+)\}\}/g,i=t.textContent;if(e.test(i)){var r=i.replace(e,function(){return new Watcher(n.vm,1<arguments.length?arguments[1]:void 0,function(e){compileUtil.updateText(e,t,n.vm)}),1<arguments.length?arguments[1]:void 0}),a=this.splitData(r,this.vm.$data);compileUtil.updateText(a,t,this.vm)}}},{key:"splitData",value:function(e,t){return(e&&e.split(".")).reduce(function(e,t){return e[t]},t)}},{key:"compileNode",value:function(i){var r=this,e=i.getAttributeNames();(e=e.filter(this.isDirective)).forEach(function(e){var t=i.getAttribute(e),n=r.splitData(t,r.vm.$data);compileUtil[e]?compileUtil[e](n,i,r.vm,t):console.warn("can't find directive "+e)})}},{key:"isDirective",value:function(e){return e.includes("t-")}},{key:"getDOM",value:function(e){return this.isElement(e)?e:document.querySelector(e)||null}},{key:"isElement",value:function(e){return 1===e.nodeType}},{key:"isText",value:function(e){return 3===e.nodeType}},{key:"toFragment",value:function(e){for(var t=document.createDocumentFragment(),n=void 0;n=e.firstChild;)t.appendChild(n);return t}}]),i}(),compileUtil={updateText:function(e,t,n,i){t&&(t.textContent=e)},"t-model":function(e,t,n,i){var r=this;t&&(t.value=e),t.addEventListener("input",function(e){r.setVal(n.$data,i,e.target.value)})},setVal:function(e,t,n){var i=t.split(".");i.reduce(function(e,t){if(i.indexOf(t)!=i.length-1)return e[t];e[t]=n},e)}},TVVM=function(){function t(e){classCallCheck(this,t),this.$el=e.el,this.$data="function"==typeof e.data?e.data():e.data,this.proxy(this.$data),this.$el&&(new Observer(this.$data),new Compiler(this.$el,this))}return createClass(t,[{key:"proxy",value:function(n){var e=this;Object.keys(n).forEach(function(t){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return n[t]},set:function(e){n[t]=e}})})}}]),t}();module.exports=TVVM;