/*! tvvm.js v1.0.0 | MIT (c) 2018 float <zexiplus@outlook.com> | https://github.com/zexiplus/TVM#readme */
"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Dep=function(){function e(){_classCallCheck(this,e),this.subs=[]}return _createClass(e,[{key:"addSubs",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach(function(e){return e.update()})}}]),e}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass$1=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Observer=function(){function t(e){_classCallCheck$1(this,t),this.observer(e)}return _createClass$1(t,[{key:"observer",value:function(t){var n=this;t&&"object"===(void 0===t?"undefined":_typeof(t))&&Object.keys(t).forEach(function(e){n.observer(t[e]),n.setReactive(t,e)})}},{key:"setReactive",value:function(t,n){var r=t[n],i=this,a=new Dep;Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return Dep.target&&a.addSubs(Dep.target),r},set:function(e){e!==t[n]&&(i.observer(e),r=e,a.notify())}})}}]),t}(),_createClass$2=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Watcher=function(){function r(e,t,n){_classCallCheck$2(this,r),this.vm=e,this.expr=t,this.cb=n,this.value=this.getValAndSetTarget()}return _createClass$2(r,[{key:"getValAndSetTarget",value:function(){var e=(Dep.target=this).getValue(this.expr);return Dep.target=null,e}},{key:"getValue",value:function(e){return e.split(".").reduce(function(e,t){return e[t]},this.vm.$data)}},{key:"update",value:function(){var e=this.value,t=this.getValue(this.expr);e!==t&&this.cb&&this.cb(t)}}]),r}(),compileUtil={updateText:function(e,t,n,r){t&&(t.textContent=e)},"t-model":function(e,t,n,r){var i=this;t&&(t.value=e),t.addEventListener("input",function(e){i.setVal(n.$data,r,e.target.value)})},"t-if":function(e,t,n,r){var i=window.getComputedStyle(t);t&&(t.style.display=e?i:"none")},"t-show":function(e,t,n,r){var i=window.getComputedStyle(t);t&&(t.style.visibility=e?i:"hidden")},"t-for":function(e,t,n,r){var i=3+r.indexOf("in"),a=r.slice(i),o=r.slice(0,i-4),l=this.getVal(n.$data,a),c=/\{\{([^}]+)\}\}/g;if(!Array.isArray(l))return console.warn("t-for value must be an array");var u=t.parentElement;u.removeChild(t);var s=t.cloneNode(!0);s.setAttribute("t-scope",a),s.setAttribute("t-itemname",o),s.removeAttribute("t-for"),s.setAttribute("t-index",0),s.setAttribute("is-t-for","true"),l.forEach(function(e,t){var n=s.cloneNode(!0);if(n.setAttribute("t-index",t),n.textContent){var r=n.textContent.match(/\{\{([^}]+)\}\}/)[1],i=Function("item","return "+r)(e);n.textContent=n.textContent.replace(c,i)}u.appendChild(n)})},setVal:function(e,t,n){var r=t.split(".");r.reduce(function(e,t){if(r.indexOf(t)!=r.length-1)return e[t];e[t]=n},e)},getVal:function(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}},_createClass$3=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var privateDirectives=["is-t-for","t-index","t-scope","t-itemname"],Compiler=function(){function r(e,t){if(_classCallCheck$3(this,r),this.el=this.getDOM(e),this.vm=t,this.el){var n=this.toFragment(this.el);this.compile(n),this.el.appendChild(n)}else console.error("can not find element named "+e);this.vm.$el=this.el}return _createClass$3(r,[{key:"compile",value:function(e){var n=this;e.childNodes.forEach(function(e,t){n.isElement(e)?(n.compile(e),n.compileNode(e)):n.isText(e)&&n.compileText(e)})}},{key:"compileText",value:function(t){var n=this,e=/\{\{([^}]+)\}\}/g,r=t.textContent;if(e.test(r))if(t.parentElement.getAttribute("t-for")||t.parentElement.getAttribute("is-t-for"));else{var i=r.replace(e,function(){return new Watcher(n.vm,1<arguments.length?arguments[1]:void 0,function(e){compileUtil.updateText(e,t,n.vm)}),1<arguments.length?arguments[1]:void 0}),a=this.splitData(i,this.vm.$data);compileUtil.updateText(a,t,this.vm)}}},{key:"splitData",value:function(e,t){return(e&&e.split(".")).reduce(function(e,t){return e[t]},t)}},{key:"compileNode",value:function(c){var u=this,e=c.getAttributeNames();e.filter(this.isDirective).forEach(function(e){var t=c.getAttribute(e),n=u.splitData(t,u.vm.$data);compileUtil[e]?compileUtil[e](n,c,u.vm,t):u.isPrivateDirective(e)||u.isEventBinding(e)||console.warn("can't find directive "+e)}),e.filter(this.isEventBinding).forEach(function(e){var n=c.getAttribute(e),t=e.slice(1),r=/\(([^)]+)\)/,i=r.test(n),a=n.replace(r,""),o=u.splitData(a,u.vm.methods);if(c.getAttribute("is-t-for"))c.parentElement.addEventListener(t,function(e){if(e.target.getAttribute("is-t-for"))if(i){n.match(r)[1].split(",").map(function(e){return u.splitData(e.trim(),u.vm.$data)});var t=u.splitData(e.target.getAttribute("t-scope"),u.vm.$data)[e.target.getAttribute("t-index")];o.call(u.vm,t)}else o.call(u.vm)});else if(i){var l=n.match(r)[1].split(",").map(function(e){return u.splitData(e.trim(),u.vm.$data)});c.addEventListener(t,o.bind.apply(o,[u.vm].concat(_toConsumableArray(l))))}else c.addEventListener(t,o.bind(u.vm))})}},{key:"isPrivateDirective",value:function(e){return privateDirectives.includes(e)}},{key:"isEventBinding",value:function(e){return/^@/.test(e)}},{key:"isDirective",value:function(e){return e.includes("t-")}},{key:"getDOM",value:function(e){return this.isElement(e)?e:document.querySelector(e)||null}},{key:"isElement",value:function(e){return 1===e.nodeType}},{key:"isText",value:function(e){return 3===e.nodeType}},{key:"toFragment",value:function(e){for(var t=document.createDocumentFragment(),n=void 0;n=e.firstChild;)t.appendChild(n);return t}}]),r}(),_createClass$4=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Lifecycle=function(){function n(e,t){_classCallCheck$4(this,n),this.hooks={},this.init(e,t),t.lifecycle=this,t.callHook=this.callHook.bind(this)}return _createClass$4(n,[{key:"init",value:function(e,n){var r={beforeCreate:e.beforeCreate,created:e.created,beforeMount:e.beforeMount,mounted:e.mounted,beforeUpdate:e.beforeUpdate,updated:e.updated,beforeDestory:e.beforeDestory,destoried:e.destoried};Object.keys(r).forEach(function(e,t){void 0===r[e]&&(r[e]=emptyFn),r[e]=r[e]instanceof Function?r[e].bind(n):(console.warn("lifecycle hooks must be a function"),emptyFn)}),this.hooks=r}},{key:"callHook",value:function(e){this.hooks[e]()}}]),n}();function emptyFn(){}var _createClass$5=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var TVVM=function(){function t(e){_classCallCheck$5(this,t),new Lifecycle(e,this),this.callHook("beforeCreate"),this.$data="function"==typeof e.data?e.data():e.data,this.methods=e.methods,this.proxy(this.$data,this),this.proxy(e.methods,this),e.el&&(new Observer(this.$data),this.callHook("created"),this.callHook("beforeMount"),new Compiler(e.el,this),this.callHook("mounted"))}return _createClass$5(t,[{key:"proxy",value:function(n,r){Object.keys(n).forEach(function(t){Object.defineProperty(r,t,{enumerable:!0,configurable:!0,get:function(){return n[t]},set:function(e){void 0!==r[t]&&console.warn("key "+t+" has already in Target"),n[t]=e}})})}}]),t}();module.exports=TVVM;