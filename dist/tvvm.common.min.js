/*! tvvm.js v1.0.0 | MIT (c) 2018 float <zexiplus@outlook.com> | https://github.com/zexiplus/TVM#readme */
"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Dep=function(){function e(){_classCallCheck(this,e),this.subs=[]}return _createClass(e,[{key:"addSubs",value:function(e){this.subs.push(e)}},{key:"notify",value:function(){this.subs.forEach(function(e){return e.update()})}}]),e}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass$1=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Observer=function(){function t(e){_classCallCheck$1(this,t),this.observer(e)}return _createClass$1(t,[{key:"observer",value:function(t){var n=this;t&&"object"===(void 0===t?"undefined":_typeof(t))&&Object.keys(t).forEach(function(e){n.observer(t[e]),n.setReactive(t,e)})}},{key:"setReactive",value:function(t,n){var r=t[n],a=this,i=new Dep;Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return Dep.target&&i.addSubs(Dep.target),r},set:function(e){e!==t[n]&&(a.observer(e),r=e,i.notify())}})}}]),t}(),_createClass$2=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Watcher=function(){function r(e,t,n){_classCallCheck$2(this,r),this.vm=e,this.expr=t,this.cb=n,this.value=this.getValAndSetTarget()}return _createClass$2(r,[{key:"getValAndSetTarget",value:function(){var e=(Dep.target=this).getValue(this.expr);return Dep.target=null,e}},{key:"getValue",value:function(e){return e.split(".").reduce(function(e,t){return e[t]},this.vm.$data)}},{key:"update",value:function(){var e=this.value,t=this.getValue(this.expr);e!==t&&this.cb&&this.cb(t)}}]),r}(),_createClass$3=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Compiler=function(){function r(e,t){if(_classCallCheck$3(this,r),this.el=this.getDOM(e),this.vm=t,this.el){var n=this.toFragment(this.el);this.compile(n),this.el.appendChild(n)}else console.error("can not find element named "+e)}return _createClass$3(r,[{key:"compile",value:function(e){var n=this;e.childNodes.forEach(function(e,t){n.isElement(e)?(n.compile(e),n.compileNode(e)):n.isText(e)&&n.compileText(e)})}},{key:"compileText",value:function(t){var n=this,e=/\{\{([^}]+)\}\}/g,r=t.textContent;if(e.test(r)){var a=r.replace(e,function(){return new Watcher(n.vm,1<arguments.length?arguments[1]:void 0,function(e){compileUtil.updateText(e,t,n.vm)}),1<arguments.length?arguments[1]:void 0}),i=this.splitData(a,this.vm.$data);compileUtil.updateText(i,t,this.vm)}}},{key:"splitData",value:function(e,t){return(e&&e.split(".")).reduce(function(e,t){return e[t]},t)}},{key:"compileNode",value:function(r){var a=this,e=r.getAttributeNames();(e=e.filter(this.isDirective)).forEach(function(e){var t=r.getAttribute(e),n=a.splitData(t,a.vm.$data);compileUtil[e]?compileUtil[e](n,r,a.vm,t):console.warn("can't find directive "+e)})}},{key:"isDirective",value:function(e){return e.includes("t-")}},{key:"getDOM",value:function(e){return this.isElement(e)?e:document.querySelector(e)||null}},{key:"isElement",value:function(e){return 1===e.nodeType}},{key:"isText",value:function(e){return 3===e.nodeType}},{key:"toFragment",value:function(e){for(var t=document.createDocumentFragment(),n=void 0;n=e.firstChild;)t.appendChild(n);return t}}]),r}(),compileUtil={updateText:function(e,t,n,r){t&&(t.textContent=e)},"t-model":function(e,t,n,r){var a=this;t&&(t.value=e),t.addEventListener("input",function(e){a.setVal(n.$data,r,e.target.value)})},setVal:function(e,t,n){var r=t.split(".");r.reduce(function(e,t){if(r.indexOf(t)!=r.length-1)return e[t];e[t]=n},e)}},_createClass$4=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var TVVM=function(){function t(e){_classCallCheck$4(this,t),this.$el=e.el,this.$data="function"==typeof e.data?e.data():e.data,this.proxy(this.$data),this.$el&&(new Observer(this.$data),new Compiler(this.$el,this))}return _createClass$4(t,[{key:"proxy",value:function(n){var e=this;Object.keys(n).forEach(function(t){Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return n[t]},set:function(e){n[t]=e}})})}}]),t}();module.exports=TVVM;